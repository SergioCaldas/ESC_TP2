
#FICHEIRO MODELO PBS CRIADO PARA A DISCIPLINA DE CPD::ESC
#!/bin/sh

#          Remarks: A line beginning with # is a comment.
#          A line beginning with #PBS is a PBS directive.
#          PBS directives must come first; any directives
#          after the first executable statement are ignored.

#PBS -N trapezoide_rule
#PBS -l walltime=00:10:00
#PBS -q mei

#          PBS can send informative email messages to you about the
#          status of your job.  Specify a string which consists of
#          either the single character "n" (no mail), or one or more
#          of the characters "a" (send mail when job is aborted),
#          "b" (send mail when job begins), and "e" (send mail when
#          job terminates).  The default is "a" if not specified.
#          You should also specify the email address to which the
#          message should be send via the -M option.

#PBS -m abe
#PBS -M a57779@alunos.uminho.pt

#          Specify the number of nodes requested and the
#          number of processors per node. 

#PBS -l nodes=1:r431:ppn=24

cd Trapezoide

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in trap_busy trap_mutex trap_sem
  do
    for ((i=0;i<10;i++))
    do
      ./$file $nt >> $file"_"$nt.csv
    done
  done
done

mv *.csv ../
cd ..

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in trap_busy_$nt.csv
  do
    gawk -f media.gawk $file >> "media_"$nt"_trap_busy".csv
  done
done

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in trap_mutex_$nt.csv
  do
    gawk -f media.gawk $file >> "media_"$nt"_trap_mutex".csv
  done
done

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in trap_sem_$nt.csv
  do
    gawk -f media.gawk $file >> "media_"$nt"_trap_sem".csv
  done
done

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in media_$nt*_busy.csv
  do
    gawk -f limpar.gawk $file >> "medias_trap_busy".csv
  done
done

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in media_$nt*_mutex.csv
  do
    gawk -f limpar.gawk $file >> "medias_trap_mutex".csv
  done
done

for nt in 1 2 4 8 12 16 24 28 32 36 40 44 48
do
  for file in media_$nt*_sem.csv
  do
    gawk -f limpar.gawk $file >> "medias_trap_sem".csv
  done
done

rm media_*
rm trap_*

mkdir Medias_Trap
mv medias_* Medias_Trap
